# 第 7 部分：智能体中的记忆系统


---

在过去的几个部分中，我们探讨了智能体如何行动——从**工具**和**RAG**，到**MCP**和**推理模型**。

今天，我们将转向决定智能体**长期表现**的因素：**记忆**。

因为有一个基本事实：
AI 模型**本身没有记忆**。它们在设计上是**无状态的**。除非你**在系统中构建记忆功能**，否则每个输入都会被独立处理。

---

## 为什么记忆很重要
<img width="438" height="164" alt="image" src="https://github.com/user-attachments/assets/1d3fccea-8f9a-42b8-baa4-b3fe9f57dad1" />


_图片来源：https://arxiv.org/html/2502.12110v1_

如果智能体帮助你起草电子邮件、总结长线程或在数天或数周内管理工作流——它需要记住：
- 电子邮件格式
- 用户姓名
- 使用的语气

当然，你可以在每个提示中反复传递这些信息……
但如果智能体能够在正确的时间从**外部数据库**中**自行检索**正确的信息，不是更好吗？

这正是**记忆**的用武之地。

---

## “等等……这不就像 Agentic RAG（第 4 天）吗？”

问得好——你说得没错。管理记忆看起来很像使用 Agentic RAG。

你需要：
1. 编写结构化或非结构化的记忆（事实、日志、过去的输出）
2. 用元数据、标签或嵌入存储它们
3. 在需要时检索相关片段
4. 使用该上下文为模型的下一个行动提供依据

**区别在于：**
- **RAG** → 帮助用知识回答问题。
- **记忆** → 帮助智能体随着时间推移保持一致的行为。

---

## 智能体中的两种记忆类型

在设计现实世界的智能体系统时，你通常会处理**两种类型的记忆**。

<img width="571" height="372" alt="image" src="https://github.com/user-attachments/assets/7c2d9e58-a219-4cea-b9f0-6de091298d66" />


_图片来源：https://langchain-ai.github.io/langgraph/concepts/memory/#what-is-memory_

---

### 1. 短期记忆

仅限于单个会话或任务。

**包括：**
- 到目前为止的对话
- 使用过的工具
- 生成的响应
- 检索到的文档

可以将其视为用户与智能体对话的原始日志。

LangGraph、Autogen 和类似框架将其视为智能体**状态**的一部分。
但状态增长很快，大多数智能体在被无关历史淹没时表现不佳。

**管理短期记忆的策略：**
- 修剪过时的消息
- 将过去的对话总结为关键点
- 根据相关性进行过滤

这是一种平衡行为：**上下文长度 vs 清晰度 vs 成本**。

---

### 2. 长期记忆

跨会话、数天、数周甚至永久存在。

**帮助智能体记住：**
- 用户是谁
- 他们喜欢如何交互
- 已经完成了什么
- 重要的过去上下文

**例子：**
- “用户偏好中性语气”
- “用户姓名是 X，居住在城市 Y”
- “发票 #123 已经升级处理”

更多数据并不一定更好——关键是在正确的时间检索正确的信息。

---

## 需要考虑的长期记忆类型

借鉴认知科学：

- **语义记忆** → 事实和信息（客观）
  _“用户说英语，偏好 Excel 文件。”_

- **情景记忆** → 过去的行动
  _“智能体昨天已经生成了摘要。”_

- **程序记忆** → 偏好（主观）
  _“避免被动语态。优先处理行动项。”_

---

**按用例分类的例子：**

- **面向用户的聊天机器人** → 使用语义记忆进行个性化
- **流程自动化智能体** → 使用情景记忆避免重试或循环
- **自适应助手** → 使用程序记忆根据反馈调整提示

---

## 关键设计问题

在说“我们需要记忆”之前，先问：
- **哪种类型的记忆？**
- **为什么需要它？**
- **如何存储、检索和保持更新？**

---

## 实践中的记忆管理

管理记忆通常感觉像管理 RAG。
困难的部分是决定**存储什么**和**检索什么**。

将更多文本塞进智能体输入很少有帮助——它往往会**损害性能**。

你需要基于以下因素有意设计记忆：
- 智能体的工作
- 它需要回忆什么
- 何时应该回忆
- 如何随着时间推移保持有用

---

## 几个企业例子

**客户支持智能体**
- 需要：最近的支持历史、已知 bug、用户情绪
- 记忆类型：情景 + 语义

**销售副驾驶**
- 需要：之前的推销、用户异议、成交状态
- 记忆类型：语义 + 程序

**合规审计智能体**
- 需要：标记的项目、先前的例外情况、政策变更
- 记忆类型：情景

---

在所有情况下，关键不在于**存储多少**数据——而在于数据**有多相关和结构化**。

是的，我已经多次强调过，但我还要再说一遍：
> **始终以问题为先。** 记忆策略，就像工具或规划一样，完全取决于你要解决的问题。

---

## 接下来

在下一部分中，我们将讨论**多智能体系统**——它们是什么、如何协调，以及你是否真的需要多个智能体。